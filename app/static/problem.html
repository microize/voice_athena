<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem - Athena</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3csvg width='32' height='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='16' cy='16' r='16' fill='%23ff4a00'/%3e%3ctext x='16' y='22' text-anchor='middle' font-family='Arial, sans-serif' font-size='20' font-weight='bold' fill='white'%3eA%3c/text%3e%3c/svg%3e">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Note: For production, replace with compiled Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ff4a00',
                        background: '#ececec',
                        foreground: '#222',
                        screen: '#f3f3f3'
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --background: #ececec;
            --foreground: #222;
            --primary: #ff4a00;
            --screen: #f3f3f3;
            --success: #28a745;
            --error: #dc3545;
            --warning: #ffc107;
            --easy: #00b894;
            --medium: #fdcb6e;
            --hard: #d63031;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--background);
            color: var(--foreground);
            font-size: 14px;
            line-height: 1.4;
            height: 100vh;
            overflow: hidden;
        }

        .page-container {
            width: 100%;
            max-width: none !important;
            height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* Page specific styles only */

        /* Main split layout */
        .main-content {
            flex: 1;
            display: flex;
            width: 100%;
            height: calc(100vh - 80px);
            overflow: hidden;
        }

        .left-panel {
            width: 50%;
            background: white;
            border-right: 1px solid rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: width 0.3s ease-in-out;
        }

        .left-panel.collapsed {
            width: 40px;
            min-width: 40px;
        }

        .right-panel {
            width: 50%;
            display: flex;
            flex-direction: column;
            background: var(--screen);
            transition: width 0.3s ease-in-out;
        }

        .right-panel.expanded {
            width: calc(100% - 40px);
        }

        /* Removed old problem header styles */

        /* Problem info section inside tab */
        .problem-info {
            padding: 20px 20px 0 20px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }


        .problem-toggle-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-left: 8px;
            margin-top: 12px;
            margin-bottom: 12px;
            flex-shrink: 0;
            align-self: center;
        }

        .problem-toggle-btn:hover {
            background: #e6420a;
            transform: scale(1.1);
        }


        .problem-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--foreground);
            margin-bottom: 8px;
        }

        .problem-meta {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .difficulty-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .difficulty-easy { background: rgba(0, 184, 148, 0.1); color: var(--easy); }
        .difficulty-medium { background: rgba(253, 203, 110, 0.1); color: #d68910; }
        .difficulty-hard { background: rgba(214, 48, 49, 0.1); color: var(--hard); }

        .problem-category {
            font-size: 12px;
            color: var(--primary);
            font-weight: 500;
        }

        .problem-tags {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .tag {
            background: rgba(255, 74, 0, 0.1);
            color: var(--primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
        }

        /* Problem Tabs */
        .problem-tabs {
            display: flex;
            background: var(--screen);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
            align-items: stretch;
            padding: 0 16px;
            min-height: 48px;
            box-sizing: border-box;
        }

        .problem-tab {
            padding: 6px 12px;
            background: none;
            border: none;
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            color: rgba(34, 34, 34, 0.7);
            flex: 1;
            min-width: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .problem-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 500;
            background: white;
        }

        .problem-tab:hover {
            color: var(--primary);
            background: rgba(255, 74, 0, 0.05);
        }

        .problem-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .problem-tab-content {
            flex: 1;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .problem-tab-content.active {
            display: flex;
        }

        .problem-description {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            transition: all 0.3s ease-in-out;
        }

        .left-panel.collapsed .problem-content {
            display: none;
        }

        .left-panel.collapsed .problem-tabs {
            justify-content: center;
            align-items: flex-end;
            padding: 0;
            padding-bottom: 10px;
            height: 100%;
            background: var(--screen);
        }

        .left-panel.collapsed .problem-tab {
            display: none;
        }

        .left-panel.collapsed .problem-toggle-btn {
            margin-left: 0;
            margin-top: 0;
            margin-bottom: 0;
            width: 28px;
            height: 28px;
            font-size: 14px;
        }

        /* Solution Display Styles */
        .solution-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .solution-header {
            padding: 12px 16px;
            background: var(--screen);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .solution-language-select {
            padding: 6px 10px;
            border: 1px solid rgba(0,0,0,0.2);
            border-radius: 4px;
            font-family: inherit;
            font-size: 12px;
            background: white;
        }

        .solution-editor-container {
            flex: 1;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            min-height: 250px;
        }

        #solution-monaco-editor {
            height: 100%;
            width: 100%;
        }

        .solution-explanation {
            height: 120px;
            overflow: hidden;
            background: white;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .solution-info-bar {
            display: flex;
            height: 100%;
            background: white;
        }

        .solution-info-section {
            flex: 1;
            padding: 12px 16px;
            overflow-y: auto;
            border-right: 1px solid rgba(0,0,0,0.1);
        }

        .solution-info-section:last-child {
            border-right: none;
        }

        .complexity-section {
            flex: 0 0 200px;
            background: #f8f9fa;
        }

        .solution-explanation h4 {
            margin: 0 0 8px 0;
            font-size: 12px;
            color: var(--primary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .solution-approach-text {
            font-size: 12px;
            line-height: 1.4;
            color: var(--foreground);
        }

        #solutionComplexity div {
            margin-bottom: 4px;
            font-size: 12px;
        }

        #solutionComplexity strong {
            min-width: 50px;
            display: inline-block;
            color: var(--primary);
        }

        .problem-description h3 {
            margin: 16px 0 8px 0;
            font-size: 14px;
            font-weight: 500;
        }

        .problem-description pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            font-size: 12px;
            line-height: 1.4;
            overflow-x: auto;
            margin: 8px 0;
        }

        .problem-description ul {
            padding-left: 20px;
            margin: 8px 0;
        }

        .problem-description li {
            margin-bottom: 4px;
        }

        /* Enhanced problem description styles */
        .problem-section {
            margin-bottom: 24px;
        }

        .problem-section:last-child {
            margin-bottom: 0;
        }

        .example-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 16px;
            margin: 12px 0;
            font-family: 'JetBrains Mono', monospace;
        }

        .example-item {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .example-item:last-child {
            margin-bottom: 0;
        }

        .example-item strong {
            color: var(--foreground);
            font-weight: 600;
            min-width: 80px;
            display: inline-block;
        }

        .example-item code {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: inherit;
            color: #d73a49;
            font-size: 13px;
        }

        .constraints-list {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 16px 16px 16px 36px;
            margin: 12px 0;
        }

        .constraints-list li {
            margin-bottom: 8px;
            color: var(--foreground);
        }

        .constraints-list li:last-child {
            margin-bottom: 0;
        }

        .constraints-list code {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'JetBrains Mono', monospace;
            color: #6f42c1;
            font-size: 12px;
        }

        /* Code editor panel */
        .editor-header {
            padding: 12px 16px;
            background: var(--screen);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            position: relative;
            transition: all 0.3s ease-in-out;
        }

        .editor-header.collapsed {
            display: none;
        }

        .editor-toggle-btn {
            position: absolute;
            top: -12px;
            right: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px 4px 0 0;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .editor-toggle-btn:hover {
            background: #e6420a;
            transform: scale(1.1);
        }

        .language-select {
            padding: 6px 10px;
            border: 1px solid rgba(0,0,0,0.2);
            border-radius: 4px;
            font-family: inherit;
            font-size: 12px;
            background: white;
        }

        .editor-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .action-btn.run {
            background: var(--primary);
            color: white;
        }

        .action-btn.run:hover {
            background: #e6420a;
        }

        .action-btn.submit {
            background: var(--success);
            color: white;
        }

        .action-btn.submit:hover {
            background: #218838;
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .editor-container {
            flex: 1;
            position: relative;
            min-height: 300px;
            transition: all 0.3s ease-in-out;
        }

        .editor-container.collapsed {
            display: none;
        }

        #monaco-editor {
            height: 100%;
            width: 100%;
        }

        /* Bottom Panel for Test Cases and Results */
        .bottom-panel {
            height: 300px;
            display: flex;
            flex-direction: column;
            border-top: 1px solid rgba(0,0,0,0.1);
            background: var(--screen);
            transition: all 0.3s ease-in-out;
        }

        .bottom-panel.collapsed {
            height: 30px;
            overflow: hidden;
        }

        .editor-container.expanded {
            flex: 1;
        }

        .bottom-tabs {
            display: flex;
            background: var(--screen);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
            position: relative;
        }

        .bottom-toggle-btn {
            position: absolute;
            top: 4px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .bottom-toggle-btn:hover {
            background: #e6420a;
            transform: scale(1.1);
        }

        .bottom-panel.collapsed .bottom-content {
            display: none;
        }

        .bottom-tab {
            padding: 8px 16px;
            background: none;
            border: none;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: border-color 0.2s;
            color: rgba(34, 34, 34, 0.7);
        }

        .bottom-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        .bottom-tab:hover {
            color: var(--primary);
        }

        .bottom-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .tab-content {
            flex: 1;
            overflow-y: auto;
            display: none;
            padding: 16px;
            background: white;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .test-cases-wrapper {
            flex: 1;
            overflow-y: auto;
        }

        .output-placeholder {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(34, 34, 34, 0.5);
            font-style: italic;
            text-align: center;
        }

        .test-cases-section {
            width: 50%;
            border-right: 1px solid rgba(0,0,0,0.1);
            background: white;
            display: flex;
            flex-direction: column;
        }

        .section-header {
            padding: 10px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .section-header h4 {
            margin: 0;
            font-size: 13px;
            font-weight: 500;
            color: var(--foreground);
        }

        .test-cases-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px 16px;
        }

        .test-case-item {
            margin-bottom: 12px;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            font-size: 12px;
        }

        .test-case-item:last-child {
            margin-bottom: 0;
        }

        .test-case-label {
            font-weight: 500;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .test-case-input, .test-case-output {
            font-family: 'JetBrains Mono', monospace;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 4px 6px;
            margin: 2px 0;
            font-size: 11px;
        }

        /* Results panel */
        .results-panel {
            background: white;
            width: 50%;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .results-tabs {
            display: flex;
            background: var(--screen);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .results-tab {
            padding: 8px 16px;
            background: none;
            border: none;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .results-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        .results-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .test-case {
            margin-bottom: 16px;
            padding: 12px;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 4px;
        }

        .test-case.passed {
            border-color: var(--success);
            background: rgba(40, 167, 69, 0.05);
        }

        .test-case.failed {
            border-color: var(--error);
            background: rgba(220, 53, 69, 0.05);
        }

        .test-case-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .test-case-status {
            font-size: 12px;
            font-weight: 500;
        }

        .test-case.passed .test-case-status {
            color: var(--success);
        }

        .test-case.failed .test-case-status {
            color: var(--error);
        }

        .test-case-details {
            font-size: 11px;
            color: rgba(34, 34, 34, 0.7);
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .performance-metric {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(0, 0, 0, 0.05);
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
        }

        .performance-metric.fast {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }

        .performance-metric.slow {
            background: rgba(255, 193, 7, 0.1);
            color: #856404;
        }

        .performance-metric.memory-efficient {
            background: rgba(23, 162, 184, 0.1);
            color: #0c5460;
        }

        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 4px;
        }

        .test-case.passed .status-icon {
            background: var(--success);
        }

        .test-case.failed .status-icon {
            background: var(--error);
        }

        .test-case-io {
            margin-top: 8px;
        }

        .test-case-io div {
            margin-bottom: 4px;
        }

        .test-case-io strong {
            font-weight: 500;
            min-width: 60px;
            display: inline-block;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--primary);
        }

        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: var(--error);
            font-size: 12px;
        }

        /* Custom test case styles */
        .custom-test-panel {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .custom-test-input {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--foreground);
        }

        .custom-input-field {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            background: white;
            resize: vertical;
            outline: none;
            box-shadow: inset 1px 1px 2px rgba(0,0,0,0.1);
        }

        .custom-input-field:focus {
            border-color: var(--primary);
            box-shadow: inset 1px 1px 2px rgba(0,0,0,0.1), 
                        0 0 0 2px rgba(255, 74, 0, 0.1);
        }

        .custom-test-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .action-btn.secondary:hover {
            background: #5a6268;
        }

        #codeCollapseBtn {
            border-left: 1px solid rgba(0,0,0,0.2);
            margin-left: 8px;
            padding-left: 12px;
        }

        .custom-test-result {
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 4px;
            background: white;
            padding: 12px;
        }

        .custom-test-result:empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(34, 34, 34, 0.5);
            font-style: italic;
        }

        .custom-test-result:empty::before {
            content: "Custom test results will appear here";
        }

        /* Chat Section Styles */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #f8f9fa;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 16px;
            background: var(--screen);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .chat-header h4 {
            margin: 0;
            font-size: 13px;
            color: var(--foreground);
            font-weight: 500;
        }

        .clear-chat-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            font-size: 14px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .clear-chat-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            display: flex;
            flex-direction: column;
            max-width: 85%;
        }

        .chat-message.user {
            align-self: flex-end;
        }

        .chat-message.assistant {
            align-self: flex-start;
        }

        .chat-message.system {
            align-self: center;
            max-width: 90%;
        }

        .message-content {
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 12px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chat-message.user .message-content {
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chat-message.assistant .message-content {
            background: white;
            border: 1px solid rgba(0,0,0,0.1);
            border-bottom-left-radius: 4px;
        }

        .chat-message.system .message-content {
            background: rgba(255, 74, 0, 0.1);
            border: 1px solid rgba(255, 74, 0, 0.2);
            text-align: center;
            font-style: italic;
            color: var(--primary);
        }

        .chat-input-container {
            display: flex;
            padding: 12px;
            gap: 8px;
            background: white;
            border-top: 1px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .chat-input {
            flex: 1;
            border: 1px solid rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 8px 12px;
            font-family: inherit;
            font-size: 12px;
            resize: none;
            outline: none;
            background: white;
        }

        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 74, 0, 0.1);
        }

        .send-chat-btn {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap;
        }

        .send-chat-btn:hover {
            background: #e6420a;
        }

        .send-chat-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .chat-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: rgba(34, 34, 34, 0.7);
        }

        .chat-loading .loading-spinner {
            width: 16px;
            height: 16px;
        }

        /* SQL Result Tables */
        .sql-result-table {
            margin: 10px 0;
            overflow-x: auto;
            border-radius: var(--radius-md);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }
        
        .result-table th {
            background: var(--screen);
            padding: 8px 12px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            font-weight: 600;
            text-align: left;
            color: var(--foreground);
        }
        
        .result-table td {
            padding: 6px 12px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            color: var(--foreground);
        }
        
        .result-table tr:nth-child(even) {
            background: rgba(0,0,0,0.02);
        }
        
        .result-table tr:hover {
            background: rgba(255, 74, 0, 0.05);
        }
        
        .no-results {
            padding: 20px;
            text-align: center;
            color: rgba(34, 34, 34, 0.6);
            font-style: italic;
        }
        
        .result-note {
            padding: 8px 12px;
            background: var(--screen);
            font-size: 11px;
            color: rgba(34, 34, 34, 0.7);
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-panel, .right-panel {
                width: 100%;
                height: 50%;
            }
            
            .left-panel.collapsed {
                width: 100%;
                height: 40px;
            }
            
            .right-panel.expanded {
                width: 100%;
                height: calc(100% - 40px);
            }
            
            .bottom-panel {
                height: 250px;
                flex-direction: column;
            }
            
            .bottom-panel.collapsed {
                height: 30px;
            }
            
            .test-cases-section {
                width: 100%;
                height: 120px;
                border-right: none;
                border-bottom: 1px solid rgba(0,0,0,0.1);
            }
            
            .results-panel {
                width: 100%;
            }
            
            .nav-left {
                gap: 12px;
            }
            
            /* Mobile-specific toggle button adjustments */
            .problem-toggle-btn,
            .editor-toggle-btn,
            .bottom-toggle-btn {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
            
            /* Mobile tab adjustments */
            .problem-tab {
                padding: 8px 8px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Navigation Bar -->
        <div id="navigation-container"></div>

        <div class="main-content">
            <!-- Left Panel - Problem Description -->
            <div class="left-panel">
                <!-- Problem Tabs -->
                <div class="problem-tabs">
                    <button class="problem-tab active" id="problemTab" onclick="switchProblemTab('problem')">Problem</button>
                    <button class="problem-tab" id="solutionTab" onclick="switchProblemTab('solution')">Solution</button>
                    <button class="problem-tab" id="chatTab" onclick="switchProblemTab('chat')">Chat</button>
                    <button class="problem-toggle-btn" onclick="toggleProblemPanel()" title="Collapse problem panel">←</button>
                </div>
                
                <!-- Problem Content -->
                <div class="problem-content">
                    <!-- Problem Description Tab -->
                    <div id="problemContent" class="problem-tab-content active">
                        <!-- Problem Info Section -->
                        <div class="problem-info">
                            <h1 class="problem-title" id="problemTitle">Loading...</h1>
                            <div class="problem-meta">
                                <div class="difficulty-badge" id="difficultyBadge">-</div>
                                <div class="problem-category" id="problemCategory">-</div>
                            </div>
                            <div class="problem-tags" id="problemTags"></div>
                        </div>
                        
                        <div class="problem-description" id="problemDescription">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Loading problem details...
                            </div>
                        </div>
                    </div>
                    
                    <!-- Solution Tab -->
                    <div id="solutionContent" class="problem-tab-content">
                        <div class="solution-container">
                            <div class="solution-header">
                                <select id="solutionLanguageSelect" class="solution-language-select" onchange="changeSolutionLanguage()">
                                    <option value="python">Python</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                    <option value="csharp">C#</option>
                                </select>
                            </div>
                            <div class="solution-editor-container">
                                <div id="solution-monaco-editor"></div>
                            </div>
                            <div class="solution-explanation">
                                <div class="solution-info-bar">
                                    <div class="solution-info-section">
                                        <h4>Approach</h4>
                                        <div id="solutionApproach" class="solution-approach-text">Loading solution explanation...</div>
                                    </div>
                                    <div class="solution-info-section complexity-section">
                                        <h4>Complexity</h4>
                                        <div id="solutionComplexity">
                                            <div><strong>Time:</strong> <span id="timeComplexity">-</span></div>
                                            <div><strong>Space:</strong> <span id="spaceComplexity">-</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Tab -->
                    <div id="chatContent" class="problem-tab-content">
                        <div class="chat-container">
                            <div class="chat-header">
                                <h4>💬 Ask Questions</h4>
                                <button class="clear-chat-btn" onclick="clearChat()" title="Clear chat">🗑️</button>
                            </div>
                            <div class="chat-messages" id="chatMessages">
                                <div class="chat-message system">
                                    <div class="message-content">
                                        Hi! I'm here to help you understand this problem. Ask me anything about the problem statement, approach, or solution!
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <textarea id="chatInput" class="chat-input" placeholder="Ask a question about this problem..." rows="2"></textarea>
                                <button class="send-chat-btn" onclick="sendChatMessage()" id="sendChatBtn">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Code Editor -->
            <div class="right-panel">
                <div class="editor-header">
                    <select id="languageSelect" class="language-select" onchange="changeLanguage()">
                        <option value="71">Python</option>
                        <option value="63">JavaScript</option>
                        <option value="62">Java</option>
                        <option value="54">C++</option>
                        <option value="51">C#</option>
                    </select>
                    <div class="editor-actions">
                        <button class="action-btn run" id="runBtn" onclick="runCode()" disabled>Run</button>
                        <button class="action-btn submit" id="submitBtn" onclick="submitSolution()" disabled>Submit</button>
                        <button class="action-btn secondary" id="codeCollapseBtn" onclick="toggleCodeEditor()" title="Collapse code editor">↑</button>
                    </div>
                </div>
                
                <div class="editor-container">
                    <div id="monaco-editor"></div>
                </div>

                <!-- Bottom Panel with Tabs for Test Cases and Output -->
                <div class="bottom-panel">
                    <div class="bottom-tabs">
                        <button class="bottom-toggle-btn" onclick="toggleBottomPanel()" title="Hide bottom panel">↓</button>
                        <button class="bottom-tab" id="testCasesTab" onclick="switchBottomTab('testCases')">Test Cases</button>
                        <button class="bottom-tab active" id="outputTab" onclick="switchBottomTab('output')">Output</button>
                        <button class="bottom-tab" id="customTestTab" onclick="switchBottomTab('customTest')">Custom Test</button>
                        <button class="bottom-tab" id="submissionTab" onclick="switchBottomTab('submission')">Submission</button>
                    </div>
                    
                    <div class="bottom-content">
                        <!-- Test Cases Content -->
                        <div id="testCasesContent" class="tab-content">
                            <div class="test-cases-wrapper">
                                <div class="loading">Loading test cases...</div>
                            </div>
                        </div>
                        
                        <!-- Output Content -->
                        <div id="outputContent" class="tab-content active">
                            <div class="output-placeholder">
                                Click "Run" to see your code output here
                            </div>
                        </div>
                        
                        <!-- Custom Test Content -->
                        <div id="customTestContent" class="tab-content">
                            <div class="custom-test-panel">
                                <div class="custom-test-input">
                                    <label for="customInput" class="input-label">Test Input:</label>
                                    <textarea id="customInput" class="custom-input-field" placeholder="Enter your test input here...
Example: [2,7,11,15]
9"></textarea>
                                </div>
                                <div class="custom-test-actions">
                                    <button class="action-btn run" id="runCustomBtn" onclick="runCustomTest()">Run Custom Test</button>
                                    <button class="action-btn secondary" id="clearCustomBtn" onclick="clearCustomTest()">Clear</button>
                                </div>
                                <div class="custom-test-result" id="customTestResult"></div>
                            </div>
                        </div>
                        
                        <!-- Submission Content -->
                        <div id="submissionContent" class="tab-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let editor;
        let currentProblem = null;
        let currentLanguage = 71; // Python by default
        let problemId = null;
        
        const languageMap = {
            71: 'python',
            63: 'javascript', 
            62: 'java',
            54: 'cpp',
            51: 'csharp'
        };

        // Get problem ID from URL
        const pathParts = window.location.pathname.split('/');
        problemId = parseInt(pathParts[pathParts.length - 1]);

        async function initializeMonaco() {
            return new Promise((resolve) => {
                require.config({ 
                    paths: { 
                        'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' 
                    } 
                });
                
                require(['vs/editor/editor.main'], function() {
                    editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                        value: '# Loading...',
                        language: 'python',
                        theme: 'vs-dark',
                        fontSize: 14,
                        minimap: { enabled: false },
                        scrollBeyondLastLine: false,
                        wordWrap: 'on',
                        automaticLayout: true
                    });
                    resolve();
                });
            });
        }

        async function loadProblem() {
            try {
                const response = await fetch(`/api/problems/${problemId}`);
                if (!response.ok) {
                    throw new Error('Problem not found');
                }
                
                currentProblem = await response.json();
                renderProblem();
                loadSolutionTemplate();
                
                // Configure editor based on problem type
                if (currentProblem.category === 'SQL') {
                    // Hide language selector for SQL problems
                    document.getElementById('languageSelect').style.display = 'none';
                    // Set SQL mode in editor
                    monaco.editor.setModelLanguage(editor.getModel(), 'sql');
                    // Update button text
                    document.getElementById('runBtn').textContent = 'Run Query';
                    document.getElementById('submitBtn').textContent = 'Submit Query';
                }
                
                // Enable buttons
                document.getElementById('runBtn').disabled = false;
                document.getElementById('submitBtn').disabled = false;
            } catch (error) {
                console.error('Error loading problem:', error);
                document.getElementById('problemDescription').innerHTML = `
                    <div class="error">
                        Failed to load problem. Please try again.
                    </div>
                `;
            }
        }

        function renderProblem() {
            document.getElementById('problemTitle').textContent = currentProblem.title;
            document.getElementById('difficultyBadge').textContent = currentProblem.difficulty;
            document.getElementById('difficultyBadge').className = `difficulty-badge difficulty-${currentProblem.difficulty.toLowerCase()}`;
            document.getElementById('problemCategory').textContent = currentProblem.category;
            
            // Render tags
            const tagsContainer = document.getElementById('problemTags');
            tagsContainer.innerHTML = currentProblem.tags.map(tag => 
                `<span class="tag">${tag}</span>`
            ).join('');
            
            // Render enhanced problem description with examples and constraints
            let html = '';
            
            // Main description
            if (currentProblem.description) {
                const description = currentProblem.description
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/`(.*?)`/g, '<code>$1</code>')
                    .replace(/\n/g, '<br>');
                html += `<div class="problem-section">${description}</div>`;
            }
            
            // Examples section
            if (currentProblem.examples && currentProblem.examples.length > 0) {
                html += '<div class="problem-section">';
                currentProblem.examples.forEach((example, index) => {
                    html += `
                        <h3>Example ${index + 1}:</h3>
                        <div class="example-block">
                            <div class="example-item">
                                <strong>Input:</strong> <code>${escapeHtml(example.input)}</code>
                            </div>
                            <div class="example-item">
                                <strong>Output:</strong> <code>${escapeHtml(example.output)}</code>
                            </div>
                            ${example.explanation ? `<div class="example-item"><strong>Explanation:</strong> ${escapeHtml(example.explanation)}</div>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Constraints section
            if (currentProblem.constraints && currentProblem.constraints.length > 0) {
                html += '<div class="problem-section">';
                html += '<h3>Constraints:</h3>';
                html += '<ul class="constraints-list">';
                currentProblem.constraints.forEach(constraint => {
                    html += `<li><code>${escapeHtml(constraint)}</code></li>`;
                });
                html += '</ul>';
                html += '</div>';
            }
            
            document.getElementById('problemDescription').innerHTML = html;
            
            // Render test cases in the bottom panel
            renderTestCases();
        }

        function renderTestCases() {
            const testCasesWrapper = document.querySelector('.test-cases-wrapper');
            
            if (!currentProblem.test_cases || currentProblem.test_cases.length === 0) {
                testCasesWrapper.innerHTML = '<div class="error">No test cases available</div>';
                return;
            }
            
            let html = '';
            currentProblem.test_cases.forEach((testCase, index) => {
                html += `
                    <div class="test-case-item">
                        <div class="test-case-label">Test Case ${index + 1}</div>
                        <div><strong>Input:</strong></div>
                        <div class="test-case-input">${escapeHtml(testCase.input || 'No input')}</div>
                        <div><strong>Expected Output:</strong></div>
                        <div class="test-case-output">${escapeHtml(testCase.expected_output || 'No output')}</div>
                    </div>
                `;
            });
            
            testCasesWrapper.innerHTML = html;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatTestResult(result, input, expectedOutput = null) {
            const isAccepted = result.status === 'Accepted';
            const runtime = parseFloat(result.time) || 0;
            const memory = parseInt(result.memory) || 0;
            
            // Determine performance metrics
            let performanceMetrics = '';
            if (runtime > 0) {
                const runtimeClass = runtime < 0.1 ? 'fast' : runtime > 1 ? 'slow' : '';
                performanceMetrics += `<span class="performance-metric ${runtimeClass}">⏱️ ${(runtime * 1000).toFixed(0)}ms</span>`;
            }
            
            if (memory > 0) {
                const memoryClass = memory < 1000 ? 'memory-efficient' : '';
                performanceMetrics += `<span class="performance-metric ${memoryClass}">💾 ${formatMemory(memory)}</span>`;
            }
            
            // Add language-specific metrics
            const languageMetrics = getLanguagePerformanceIndicator(runtime, memory, currentLanguage);
            if (languageMetrics) {
                performanceMetrics += languageMetrics;
            }
            
            return `
                <div class="test-case ${isAccepted ? 'passed' : 'failed'}">
                    <div class="test-case-header">
                        <div class="test-case-status">
                            <span class="status-icon"></span>
                            ${result.status}
                        </div>
                        <div class="test-case-details">
                            ${performanceMetrics}
                        </div>
                    </div>
                    <div class="test-case-io">
                        <div><strong>Input:</strong> <code>${escapeHtml(input)}</code></div>
                        <div><strong>Output:</strong> <code>${result.stdout || 'No output'}</code></div>
                        ${expectedOutput ? `<div><strong>Expected:</strong> <code>${escapeHtml(expectedOutput)}</code></div>` : ''}
                        ${result.stderr ? `<div><strong>Error:</strong> <pre style="color: var(--error); margin: 4px 0;">${escapeHtml(result.stderr)}</pre></div>` : ''}
                        ${result.compile_output ? `<div><strong>Compile Output:</strong> <pre style="color: var(--warning); margin: 4px 0;">${escapeHtml(result.compile_output)}</pre></div>` : ''}
                    </div>
                </div>
            `;
        }
        
        function formatMemory(bytes) {
            if (bytes < 1024) return `${bytes}B`;
            if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)}KB`;
            return `${(bytes / (1024 * 1024)).toFixed(1)}MB`;
        }
        
        function getLanguagePerformanceIndicator(runtime, memory, languageId) {
            const languageNames = {
                71: 'Python',
                63: 'JavaScript', 
                62: 'Java',
                54: 'C++',
                51: 'C#'
            };
            
            const langName = languageNames[languageId] || 'Unknown';
            
            // Performance expectations by language (rough guidelines)
            const expectations = {
                71: { fastThreshold: 0.2, efficientMemory: 2000 }, // Python
                63: { fastThreshold: 0.1, efficientMemory: 1500 }, // JavaScript
                62: { fastThreshold: 0.15, efficientMemory: 3000 }, // Java
                54: { fastThreshold: 0.05, efficientMemory: 1000 }, // C++
                51: { fastThreshold: 0.1, efficientMemory: 2000 }  // C#
            };
            
            const expected = expectations[languageId];
            if (!expected) return '';
            
            let indicator = '';
            if (runtime > 0 && runtime <= expected.fastThreshold) {
                indicator += `<span class="performance-metric fast">🚀 Fast ${langName}</span>`;
            }
            
            if (memory > 0 && memory <= expected.efficientMemory) {
                indicator += `<span class="performance-metric memory-efficient">✨ Efficient</span>`;
            }
            
            return indicator;
        }
        
        function formatSubmissionSummary(result) {
            const isAccepted = result.accepted;
            const runtime = result.runtime || 0;
            const memory = result.memory || 0;
            
            let performanceMetrics = '';
            if (runtime > 0) {
                performanceMetrics += `<span class="performance-metric">⏱️ ${(runtime * 1000).toFixed(0)}ms avg</span>`;
            }
            
            if (memory > 0) {
                performanceMetrics += `<span class="performance-metric">💾 ${formatMemory(memory)} peak</span>`;
            }
            
            // Add percentile information (simulated for demo)
            const timePercentile = Math.floor(Math.random() * 40) + 60; // 60-99%
            const memoryPercentile = Math.floor(Math.random() * 40) + 60; // 60-99%
            
            if (isAccepted) {
                performanceMetrics += `<span class="performance-metric fast">🎯 Beats ${timePercentile}% (time)</span>`;
                performanceMetrics += `<span class="performance-metric memory-efficient">📊 Beats ${memoryPercentile}% (memory)</span>`;
            }
            
            return `
                <div class="test-case ${isAccepted ? 'passed' : 'failed'}">
                    <div class="test-case-header">
                        <div class="test-case-status">
                            <span class="status-icon"></span>
                            ${result.status}
                        </div>
                        <div class="test-case-details">
                            ${performanceMetrics}
                        </div>
                    </div>
                    <div class="test-case-io">
                        <div><strong>Result:</strong> ${isAccepted ? 'Accepted ✅' : 'Wrong Answer ❌'}</div>
                        <div><strong>Test Cases:</strong> ${result.test_cases_passed} passed out of ${result.total_test_cases || 'unknown'}</div>
                        ${!isAccepted ? '<div style="margin-top: 8px; color: var(--error);">💡 Check your logic and try again. Consider edge cases!</div>' : 
                            '<div style="margin-top: 8px; color: var(--success);">🎉 Congratulations! Your solution passed all test cases!</div>'}
                    </div>
                </div>
            `;
        }

        function loadSolutionTemplate() {
            const templates = currentProblem.solution_template || {};
            
            if (currentProblem.category === 'SQL') {
                // Handle SQL templates
                let template = templates['sql'] || '-- Write your SQL query here\nSELECT \n    \nFROM \n    ';
                
                if (editor) {
                    editor.setValue(template);
                    
                    // Set to SQL language mode
                    const model = editor.getModel();
                    if (model && monaco.editor.setModelLanguage) {
                        monaco.editor.setModelLanguage(model, 'sql');
                    }
                    
                    editor.setPosition({lineNumber: 2, column: 5}); // Position after "SELECT "
                    editor.focus();
                }
                return;
            }
            
            const languageName = languageMap[currentLanguage];
            const monacoLanguage = getMonacoLanguage(currentLanguage);
            
            // Get language-specific template or fallback
            let template = templates[languageName];
            if (!template) {
                // Provide language-specific fallbacks
                const fallbacks = {
                    'python': '# Write your solution here\ndef solution():\n    pass',
                    'javascript': '// Write your solution here\nfunction solution() {\n    \n}',
                    'java': '// Write your solution here\nclass Solution {\n    public void solution() {\n        \n    }\n}',
                    'cpp': '// Write your solution here\n#include <iostream>\nusing namespace std;\n\nclass Solution {\npublic:\n    void solution() {\n        \n    }\n};',
                    'csharp': '// Write your solution here\nusing System;\n\npublic class Solution {\n    public void Solution() {\n        \n    }\n}'
                };
                template = fallbacks[languageName] || '// Write your solution here';
            }
            
            if (editor) {
                editor.setValue(template);
                
                // Set language using Monaco's proper API
                const model = editor.getModel();
                if (model && monaco.editor.setModelLanguage) {
                    monaco.editor.setModelLanguage(model, monacoLanguage);
                }
                
                // Set cursor position at the end of the function signature
                editor.setPosition({lineNumber: 1, column: 1});
                editor.focus();
            }
        }

        function getMonacoLanguage(languageId) {
            const map = {
                71: 'python',
                63: 'javascript',
                62: 'java', 
                54: 'cpp',
                51: 'csharp'
            };
            return map[languageId] || 'python';
        }

        function changeLanguage() {
            currentLanguage = parseInt(document.getElementById('languageSelect').value);
            loadSolutionTemplate();
        }

        async function runCode() {
            const code = editor.getValue();
            if (!code.trim()) {
                alert(currentProblem.category === 'SQL' ? 'Please write some SQL query first' : 'Please write some code first');
                return;
            }

            document.getElementById('runBtn').disabled = true;
            document.getElementById('runBtn').textContent = currentProblem.category === 'SQL' ? 'Running Query...' : 'Running...';
            
            // Switch to output tab
            switchBottomTab('output');
            
            document.getElementById('outputContent').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    ${currentProblem.category === 'SQL' ? 'Executing query...' : 'Executing code...'}
                </div>
            `;

            try {
                if (currentProblem.category === 'SQL') {
                    // Handle SQL query execution
                    const response = await fetch(`/api/problems/${problemId}/run-sql`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            source_code: code,
                            language_id: 0, // Not used for SQL
                            test_input: '' // Not used for SQL
                        })
                    });

                    const result = await response.json();
                    document.getElementById('outputContent').innerHTML = formatSqlResult(result);
                } else {
                    // Use the first test case for running
                    const testCase = currentProblem.test_cases[0];
                    const response = await fetch(`/api/problems/${problemId}/run`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            source_code: code,
                            language_id: currentLanguage,
                            test_input: testCase.input
                        })
                    });

                    const result = await response.json();
                    document.getElementById('outputContent').innerHTML = formatTestResult(result, testCase.input, testCase.expected_output);
                }
            } catch (error) {
                console.error('Error running code:', error);
                let errorMessage = 'Error executing code. Please try again.';
                if (error.message && error.message.includes('Failed to fetch')) {
                    errorMessage = 'Unable to connect to code execution service. Please check your connection.';
                } else if (error.message) {
                    errorMessage = `Execution error: ${error.message}`;
                }
                document.getElementById('outputContent').innerHTML = `
                    <div class="error">
                        <strong>❌ Execution Failed</strong><br>
                        ${errorMessage}<br>
                        <small>Check the debug console for more details.</small>
                    </div>
                `;
            } finally {
                document.getElementById('runBtn').disabled = false;
                document.getElementById('runBtn').textContent = currentProblem.category === 'SQL' ? 'Run Query' : 'Run';
            }
        }

        function formatSqlResult(result) {
            if (result.status === 'error') {
                return `
                    <div class="test-case failed">
                        <div class="test-case-header">
                            <div class="test-case-status">
                                <span class="status-icon"></span>
                                Query Error
                            </div>
                        </div>
                        <div class="test-case-content">
                            <div class="test-section">
                                <strong>❌ Error:</strong>
                                <pre class="test-output error">${escapeHtml(result.error || result.message)}</pre>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            const queryResult = result.result || {};
            const columns = queryResult.columns || [];
            const rows = queryResult.rows || [];
            
            let resultHtml = `
                <div class="test-case passed">
                    <div class="test-case-header">
                        <div class="test-case-status">
                            <span class="status-icon"></span>
                            Query Executed Successfully
                        </div>
                        <div class="test-case-details">
                            <span class="detail-item">📊 ${rows.length} rows returned</span>
                        </div>
                    </div>
                    <div class="test-case-content">
                        <div class="test-section">
                            <strong>✅ Result:</strong>
            `;
            
            if (rows.length > 0) {
                resultHtml += `
                    <div class="sql-result-table">
                        <table class="result-table">
                            <thead>
                                <tr>
                                    ${columns.map(col => `<th>${escapeHtml(col)}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${rows.map(row => `
                                    <tr>
                                        ${row.map(cell => `<td>${escapeHtml(String(cell))}</td>`).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                resultHtml += `<div class="no-results">Query executed successfully but returned no rows.</div>`;
            }
            
            resultHtml += `
                        </div>
                    </div>
                </div>
            `;
            
            return resultHtml;
        }

        async function submitSolution() {
            const code = editor.getValue();
            if (!code.trim()) {
                alert(currentProblem.category === 'SQL' ? 'Please write some SQL query first' : 'Please write some code first');
                return;
            }

            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = currentProblem.category === 'SQL' ? 'Submitting Query...' : 'Submitting...';
            
            // Switch to submission tab
            switchBottomTab('submission');
            
            document.getElementById('submissionContent').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    ${currentProblem.category === 'SQL' ? 'Evaluating SQL query...' : 'Judging solution against all test cases...'}
                </div>
            `;

            try {
                if (currentProblem.category === 'SQL') {
                    // Handle SQL query submission
                    const response = await fetch(`/api/problems/${problemId}/submit-sql`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            source_code: code,
                            language_id: 0 // Not used for SQL
                        })
                    });

                    const result = await response.json();
                    document.getElementById('submissionContent').innerHTML = formatSqlSubmissionSummary(result);
                } else {
                    const response = await fetch(`/api/problems/${problemId}/submit`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            source_code: code,
                            language_id: currentLanguage
                        })
                    });

                    const result = await response.json();
                    
                    // Add total test cases count to result
                    result.total_test_cases = currentProblem.test_cases ? currentProblem.test_cases.length : result.test_cases_passed;
                    
                    document.getElementById('submissionContent').innerHTML = formatSubmissionSummary(result);
                }
                
                // If accepted, maybe refresh progress or show celebration
                if (result.accepted) {
                    setTimeout(() => {
                        if (confirm('Problem solved! Would you like to go back to the problems list?')) {
                            window.location.href = '/problems';
                        }
                    }, 2000);
                }
            } catch (error) {
                console.error('Error submitting solution:', error);
                let errorMessage = 'Error submitting solution. Please try again.';
                if (error.message && error.message.includes('Failed to fetch')) {
                    errorMessage = 'Unable to connect to judging service. Please check your connection.';
                } else if (error.message) {
                    errorMessage = `Submission error: ${error.message}`;
                }
                document.getElementById('submissionContent').innerHTML = `
                    <div class="error">
                        <strong>❌ Submission Failed</strong><br>
                        ${errorMessage}<br>
                        <small>Check the debug console for more details.</small>
                    </div>
                `;
            } finally {
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn').textContent = currentProblem.category === 'SQL' ? 'Submit Query' : 'Submit';
            }
        }

        function formatSqlSubmissionSummary(result) {
            const isAccepted = result.status === 'Accepted';
            const statusColor = isAccepted ? '#28a745' : 
                               result.status === 'Runtime Error' ? '#dc3545' : '#ffc107';
            
            let html = `
                <div class="submission-summary">
                    <div class="submission-header">
                        <div class="submission-status" style="color: ${statusColor}">
                            <span class="status-icon">${isAccepted ? '✅' : '❌'}</span>
                            <strong>${result.status}</strong>
                        </div>
                        <div class="submission-score">
                            Score: ${result.score}/100
                        </div>
                    </div>
                    
                    <div class="submission-details">
                        <div class="detail-item">
                            <strong>Message:</strong> ${result.message}
                        </div>
            `;
            
            if (result.result && result.result.rows) {
                html += `
                        <div class="detail-item">
                            <strong>Query Result:</strong>
                            <div class="sql-result-table">
                                <table class="result-table">
                                    <thead>
                                        <tr>
                                            ${result.result.columns.map(col => `<th>${escapeHtml(col)}</th>`).join('')}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${result.result.rows.slice(0, 10).map(row => `
                                            <tr>
                                                ${row.map(cell => `<td>${escapeHtml(String(cell))}</td>`).join('')}
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                ${result.result.rows.length > 10 ? `<div class="result-note">Showing first 10 of ${result.result.rows.length} rows</div>` : ''}
                            </div>
                        </div>
                `;
            }
            
            if (result.error) {
                html += `
                        <div class="detail-item error">
                            <strong>Error:</strong>
                            <pre class="error-output">${escapeHtml(result.error)}</pre>
                        </div>
                `;
            }
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }

        async function runCustomTest() {
            const code = editor.getValue();
            const customInput = document.getElementById('customInput').value.trim();
            
            if (!code.trim()) {
                alert('Please write some code first');
                return;
            }
            
            if (!customInput) {
                alert('Please enter test input');
                return;
            }

            document.getElementById('runCustomBtn').disabled = true;
            document.getElementById('runCustomBtn').textContent = 'Running...';
            
            // Switch to custom test tab
            switchBottomTab('customTest');
            
            document.getElementById('customTestResult').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Executing custom test...
                </div>
            `;

            try {
                const response = await fetch(`/api/problems/${problemId}/run`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        source_code: code,
                        language_id: currentLanguage,
                        test_input: customInput
                    })
                });

                const result = await response.json();
                
                document.getElementById('customTestResult').innerHTML = formatTestResult(result, customInput);
            } catch (error) {
                console.error('Error running custom test:', error);
                let errorMessage = 'Error executing custom test. Please try again.';
                if (error.message && error.message.includes('Failed to fetch')) {
                    errorMessage = 'Unable to connect to code execution service. Please check your connection.';
                } else if (error.message) {
                    errorMessage = `Custom test error: ${error.message}`;
                }
                document.getElementById('customTestResult').innerHTML = `
                    <div class="error">
                        <strong>❌ Custom Test Failed</strong><br>
                        ${errorMessage}<br>
                        <small>Check the debug console for more details.</small>
                    </div>
                `;
            } finally {
                document.getElementById('runCustomBtn').disabled = false;
                document.getElementById('runCustomBtn').textContent = 'Run Custom Test';
            }
        }

        function clearCustomTest() {
            document.getElementById('customInput').value = '';
            document.getElementById('customTestResult').innerHTML = '';
        }

        function switchBottomTab(tab) {
            // Update tab appearance
            document.querySelectorAll('.bottom-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            // Show correct content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tab + 'Content').classList.add('active');
        }

        function switchTab(tab) {
            // Legacy function - keeping for compatibility
            switchBottomTab(tab);
        }

        // Panel toggle functions
        function toggleProblemPanel() {
            const leftPanel = document.querySelector('.left-panel');
            const rightPanel = document.querySelector('.right-panel');
            const toggleBtn = document.querySelector('.problem-toggle-btn');
            
            leftPanel.classList.toggle('collapsed');
            if (leftPanel.classList.contains('collapsed')) {
                rightPanel.classList.add('expanded');
                toggleBtn.innerHTML = '→';
                toggleBtn.title = 'Expand problem panel';
            } else {
                rightPanel.classList.remove('expanded');
                toggleBtn.innerHTML = '←';
                toggleBtn.title = 'Collapse problem panel';
            }
            
            // Trigger Monaco editor resize
            if (editor) {
                setTimeout(() => editor.layout(), 300);
            }
            
            saveLayoutState();
        }

        function toggleEditorHeader() {
            const editorHeader = document.querySelector('.editor-header');
            const toggleBtn = document.querySelector('.editor-toggle-btn');
            
            editorHeader.classList.toggle('collapsed');
            if (editorHeader.classList.contains('collapsed')) {
                toggleBtn.innerHTML = '↓';
                toggleBtn.title = 'Show editor header';
            } else {
                toggleBtn.innerHTML = '↑';
                toggleBtn.title = 'Hide editor header';
            }
            
            // Trigger Monaco editor resize
            if (editor) {
                setTimeout(() => editor.layout(), 300);
            }
            
            saveLayoutState();
        }

        function toggleBottomPanel() {
            const bottomPanel = document.querySelector('.bottom-panel');
            const editorContainer = document.querySelector('.editor-container');
            const toggleBtn = document.querySelector('.bottom-toggle-btn');
            
            bottomPanel.classList.toggle('collapsed');
            if (bottomPanel.classList.contains('collapsed')) {
                editorContainer.classList.add('expanded');
                toggleBtn.innerHTML = '↑';
                toggleBtn.title = 'Show bottom panel';
            } else {
                editorContainer.classList.remove('expanded');
                toggleBtn.innerHTML = '↓';
                toggleBtn.title = 'Hide bottom panel';
            }
            
            // Trigger Monaco editor resize
            if (editor) {
                setTimeout(() => editor.layout(), 300);
            }
            
            saveLayoutState();
        }

        function toggleCodeEditor() {
            const editorContainer = document.querySelector('.editor-container');
            const bottomPanel = document.querySelector('.bottom-panel');
            const toggleBtn = document.querySelector('#codeCollapseBtn');
            
            editorContainer.classList.toggle('collapsed');
            if (editorContainer.classList.contains('collapsed')) {
                // When code editor is collapsed, expand bottom panel to take full space
                bottomPanel.style.flex = '1';
                toggleBtn.innerHTML = '↓';
                toggleBtn.title = 'Show code editor';
            } else {
                // When code editor is expanded, reset bottom panel size
                bottomPanel.style.flex = '';
                toggleBtn.innerHTML = '↑';
                toggleBtn.title = 'Collapse code editor';
                
                // Trigger Monaco editor resize when shown
                if (editor) {
                    setTimeout(() => editor.layout(), 300);
                }
            }
            
            saveLayoutState();
        }

        // Layout state persistence
        function saveLayoutState() {
            const state = {
                problemPanelCollapsed: document.querySelector('.left-panel').classList.contains('collapsed'),
                editorHeaderCollapsed: document.querySelector('.editor-header').classList.contains('collapsed'),
                bottomPanelCollapsed: document.querySelector('.bottom-panel').classList.contains('collapsed'),
                codeEditorCollapsed: document.querySelector('.editor-container').classList.contains('collapsed')
            };
            localStorage.setItem('athena_layout_state', JSON.stringify(state));
        }

        function loadLayoutState() {
            try {
                const savedState = localStorage.getItem('athena_layout_state');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    
                    // Apply saved states without animations initially
                    const leftPanel = document.querySelector('.left-panel');
                    const rightPanel = document.querySelector('.right-panel');
                    const editorHeader = document.querySelector('.editor-header');
                    const bottomPanel = document.querySelector('.bottom-panel');
                    const editorContainer = document.querySelector('.editor-container');
                    const problemToggleBtn = document.querySelector('.problem-toggle-btn');
                    const editorToggleBtn = document.querySelector('.editor-toggle-btn');
                    const bottomToggleBtn = document.querySelector('.bottom-toggle-btn');
                    const codeCollapseBtn = document.querySelector('#codeCollapseBtn');
                    
                    // Don't restore problem panel collapsed state - always start expanded
                    // if (state.problemPanelCollapsed && leftPanel && rightPanel && problemToggleBtn) {
                    //     leftPanel.classList.add('collapsed');
                    //     rightPanel.classList.add('expanded');
                    //     problemToggleBtn.innerHTML = '→';
                    //     problemToggleBtn.title = 'Expand problem panel';
                    // }
                    
                    if (state.editorHeaderCollapsed && editorHeader && editorToggleBtn) {
                        editorHeader.classList.add('collapsed');
                        editorToggleBtn.innerHTML = '↓';
                        editorToggleBtn.title = 'Show editor header';
                    }
                    
                    if (state.bottomPanelCollapsed && bottomPanel && editorContainer && bottomToggleBtn) {
                        bottomPanel.classList.add('collapsed');
                        editorContainer.classList.add('expanded');
                        bottomToggleBtn.innerHTML = '↑';
                        bottomToggleBtn.title = 'Show bottom panel';
                    }
                    
                    if (state.codeEditorCollapsed && editorContainer && bottomPanel && codeCollapseBtn) {
                        editorContainer.classList.add('collapsed');
                        bottomPanel.style.flex = '1';
                        codeCollapseBtn.innerHTML = '↓';
                        codeCollapseBtn.title = 'Show code editor';
                    }
                }
            } catch (error) {
                console.error('Error loading layout state:', error);
            }
        }

        // Keyboard shortcuts
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey) {
                    switch (e.key) {
                        case '1':
                            e.preventDefault();
                            toggleProblemPanel();
                            break;
                        case '2':
                            e.preventDefault();
                            toggleEditorHeader();
                            break;
                        case '3':
                            e.preventDefault();
                            toggleBottomPanel();
                            break;
                        case '4':
                            e.preventDefault();
                            toggleCodeEditor();
                            break;
                    }
                }
            });
        }

        // Problem tab switching
        function switchProblemTab(tab) {
            // Update tab appearance
            document.querySelectorAll('.problem-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            // Show correct content
            document.querySelectorAll('.problem-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tab + 'Content').classList.add('active');
            
            // Load solution if switching to solution tab
            if (tab === 'solution' && !solutionEditor) {
                initializeSolutionEditor();
                loadSolution();
            }
            
            // Focus chat input if switching to chat tab
            if (tab === 'chat') {
                setTimeout(() => {
                    const chatInput = document.getElementById('chatInput');
                    if (chatInput) {
                        chatInput.focus();
                    }
                }, 100);
            }
        }

        // Solution Monaco editor
        let solutionEditor = null;
        let currentSolutionLanguage = 'python';
        
        async function initializeSolutionEditor() {
            if (solutionEditor) return;
            
            try {
                solutionEditor = monaco.editor.create(document.getElementById('solution-monaco-editor'), {
                    value: '// Loading solution...',
                    language: 'python',
                    theme: 'vs-dark',
                    fontSize: 14,
                    minimap: { enabled: false },
                    scrollBeyondLastLine: false,
                    wordWrap: 'on',
                    readOnly: true,
                    automaticLayout: true
                });
            } catch (error) {
                console.error('Error initializing solution editor:', error);
            }
        }
        
        function changeSolutionLanguage() {
            currentSolutionLanguage = document.getElementById('solutionLanguageSelect').value;
            loadSolution();
        }
        
        async function loadSolution() {
            if (!currentProblem || !solutionEditor) return;
            
            try {
                let solutionCode;
                let monacoLanguage;
                
                if (currentProblem.category === 'SQL') {
                    // For SQL problems, load from solutions field
                    solutionCode = currentProblem.solutions?.sql || '-- Solution not available for this problem';
                    monacoLanguage = 'sql';
                    // Hide language selector for SQL problems
                    document.getElementById('solutionLanguageSelect').style.display = 'none';
                } else {
                    // For coding problems, load from solution_template field
                    solutionCode = currentProblem.solution_template[currentSolutionLanguage] || 
                                  currentProblem.solution_template['python'] || 
                                  '// Solution not available for this language';
                    monacoLanguage = getMonacoLanguage(getLanguageIdFromName(currentSolutionLanguage));
                    // Show language selector for coding problems
                    document.getElementById('solutionLanguageSelect').style.display = 'block';
                }
                
                solutionEditor.setValue(solutionCode);
                
                // Set the language for syntax highlighting
                const model = solutionEditor.getModel();
                if (model && monaco.editor.setModelLanguage) {
                    monaco.editor.setModelLanguage(model, monacoLanguage);
                }
                
                // Update approach and complexity based on problem
                let problemInfo;
                
                if (currentProblem.category === 'SQL') {
                    // SQL-specific approach explanations
                    const sqlApproaches = {
                        5: { // Netflix - User's Fourth Favorite Movie
                            approach: 'Use ROW_NUMBER() window function to rank movies by watch time per user, then filter for rank 4.',
                            timeComplexity: 'O(n log n)',
                            spaceComplexity: 'O(n)'
                        },
                        6: { // PayPal - Transaction Success vs Failure Rate
                            approach: 'Use conditional aggregation with CASE statements to calculate success and failure counts, then compute percentages.',
                            timeComplexity: 'O(n)',
                            spaceComplexity: 'O(1)'
                        },
                        7: { // LinkedIn - Connection Growth Trend
                            approach: 'Use AVG() window function with ROWS BETWEEN for 7-day rolling average calculation.',
                            timeComplexity: 'O(n)',
                            spaceComplexity: 'O(n)'
                        },
                        17: { // Tesla - Manufacturing Defect Analysis
                            approach: 'Multi-step CTE approach: calculate defect rates, use LAG() for previous shift comparison, and rolling average for trend analysis.',
                            timeComplexity: 'O(n log n)',
                            spaceComplexity: 'O(n)'
                        },
                        18: { // Apple - Product Launch Success Prediction
                            approach: 'Complex analysis using multiple CTEs, CORR() function for correlation analysis, and CASE statements for classification.',
                            timeComplexity: 'O(n²)',
                            spaceComplexity: 'O(n)'
                        }
                    };
                    
                    problemInfo = sqlApproaches[problemId] || {
                        approach: 'This SQL solution uses window functions, CTEs, and aggregations to solve the analytical problem efficiently. It handles edge cases and provides scalable performance.',
                        timeComplexity: 'O(n log n)',
                        spaceComplexity: 'O(n)'
                    };
                } else {
                    // Regular coding problem approaches
                    const approaches = {
                        1: { // Two Sum
                            approach: 'Use a hash map to store numbers and their indices. For each number, check if its complement (target - current number) exists in the hash map. This reduces the time complexity from O(n²) brute force to O(n).',
                            timeComplexity: 'O(n)',
                            spaceComplexity: 'O(n)'
                        },
                        2: { // Valid Parentheses  
                            approach: 'Use a stack data structure to keep track of opening brackets. For each closing bracket, check if it matches the most recent opening bracket by popping from the stack.',
                            timeComplexity: 'O(n)',
                            spaceComplexity: 'O(n)'
                        },
                        3: { // Longest Substring Without Repeating Characters
                            approach: 'Use sliding window technique with two pointers. Maintain a set to track characters in current window. When duplicate found, shrink window from left.',
                            timeComplexity: 'O(n)',
                            spaceComplexity: 'O(min(m,n))'
                        },
                        4: { // Regular Expression Matching
                            approach: 'Use dynamic programming. Build a 2D table where dp[i][j] represents if s[0...i-1] matches p[0...j-1]. Handle . and * characters specially.',
                            timeComplexity: 'O(m×n)',
                            spaceComplexity: 'O(m×n)'
                        }
                    };
                    
                    problemInfo = approaches[problemId] || {
                        approach: 'This solution uses an optimal approach to solve the problem efficiently. The implementation follows best practices and handles edge cases appropriately.',
                        timeComplexity: 'O(n)',
                        spaceComplexity: 'O(1)'
                    };
                }
                
                document.getElementById('solutionApproach').textContent = problemInfo.approach;
                document.getElementById('timeComplexity').textContent = problemInfo.timeComplexity;
                document.getElementById('spaceComplexity').textContent = problemInfo.spaceComplexity;
                
            } catch (error) {
                console.error('Error loading solution:', error);
                solutionEditor.setValue('// Error loading solution');
            }
        }
        
        function getLanguageIdFromName(languageName) {
            const languageMap = {
                'python': 71,
                'javascript': 63,
                'java': 62,
                'cpp': 54,
                'csharp': 51
            };
            return languageMap[languageName] || 71;
        }

        // Chat functionality
        let chatHistory = [];
        
        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message) return;
            
            // Disable send button
            const sendBtn = document.getElementById('sendChatBtn');
            sendBtn.disabled = true;
            sendBtn.textContent = 'Sending...';
            
            // Add user message to chat
            addChatMessage('user', message);
            chatInput.value = '';
            
            // Add loading message
            const loadingMessage = addChatMessage('assistant', '');
            const loadingSpinner = document.createElement('div');
            loadingSpinner.className = 'chat-loading';
            loadingSpinner.innerHTML = '<div class="loading-spinner"></div> Thinking...';
            loadingMessage.querySelector('.message-content').appendChild(loadingSpinner);
            
            try {
                const response = await fetch(`/api/problems/${problemId}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        chat_history: chatHistory
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                // Remove loading message and add actual response
                loadingMessage.remove();
                addChatMessage('assistant', data.response);
                
                // Update chat history
                chatHistory.push({ role: 'user', content: message });
                chatHistory.push({ role: 'assistant', content: data.response });
                
            } catch (error) {
                console.error('Error sending chat message:', error);
                loadingMessage.remove();
                addChatMessage('assistant', 'Sorry, I encountered an error. Please try again.');
            } finally {
                // Re-enable send button
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send';
            }
        }
        
        function addChatMessage(sender, content) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.textContent = content;
            
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return messageDiv;
        }
        
        function clearChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="chat-message system">
                    <div class="message-content">
                        Hi! I'm here to help you understand this problem. Ask me anything about the problem statement, approach, or solution!
                    </div>
                </div>
            `;
            chatHistory = [];
        }
        
        // Handle Enter key in chat input
        document.addEventListener('DOMContentLoaded', () => {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', async () => {
            if (!problemId || isNaN(problemId)) {
                alert('Invalid problem ID');
                window.location.href = '/problems';
                return;
            }
            
            // Initialize keyboard shortcuts
            initKeyboardShortcuts();
            
            try {
                // Ensure navigation component is available
                if (typeof loadNavigation === 'function') {
                    await loadNavigation({activePage: 'problems', rightContent: 'backButton'});
                } else {
                    console.error('loadNavigation function not available');
                }
                
                // Add Judge0 status to debug mode if available
                setTimeout(async () => {
                    const debugToggle = document.getElementById('debugToggle');
                    if (debugToggle && debugToggle.checked) {
                        await addJudge0StatusToDebug();
                    }
                    
                    // Listen for debug toggle changes
                    if (debugToggle) {
                        debugToggle.addEventListener('change', async () => {
                            if (debugToggle.checked) {
                                await addJudge0StatusToDebug();
                            }
                        });
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Error loading navigation:', error);
                // Continue even if navigation fails
            }
            
            await initializeMonaco();
            await loadProblem();
            
            // Load saved layout state after a brief delay to ensure DOM is ready
            setTimeout(loadLayoutState, 100);
        });
        
        async function addJudge0StatusToDebug() {
            try {
                const debugPanel = document.getElementById('debugPanel');
                if (!debugPanel) return;
                
                const response = await fetch('/api/judge0/status');
                const status = await response.json();
                
                const statusHtml = `
                    <div style="margin: 10px; padding: 10px; background: white; border-radius: 4px;">
                        <h4>Judge0 Status</h4>
                        <p><strong>Status:</strong> <span style="color: ${status.status === 'connected' ? 'green' : 'red'}">${status.status}</span></p>
                        <p><strong>API URL:</strong> ${status.api_url}</p>
                        <p><strong>API Key:</strong> ${status.api_key_configured ? '✅ Configured' : '❌ Missing'}</p>
                        ${status.languages_count ? `<p><strong>Languages:</strong> ${status.languages_count} available</p>` : ''}
                        ${status.error ? `<p><strong>Error:</strong> ${status.error}</p>` : ''}
                    </div>
                `;
                
                debugPanel.innerHTML += statusHtml;
            } catch (error) {
                console.error('Error checking Judge0 status:', error);
            }
        }
    </script>
    <script src="/components/nav-component.js"></script>
</body>
</html>